

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanction Check</title>
    <!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"> -->
    <link rel="stylesheet" href="../static/sanction.css">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/image.png') }}" type="image/x-icon">
</head>
<body>
    <button id="back-button" onclick="window.location.href='/'"><i class="fa-solid fa-backward"></i></button>
    <div id="head_image">
        <img src="{{ url_for('static', filename='images/image.png') }}" alt="Example Image">
    </div>
    <h1>Sanction Check</h1>
    <form method="POST" onsubmit="showLoading(event)">
        <label for="search_type">Search Type:</label><br>
        <input type="radio" name="search_type" id="search_individual" value="INDIVIDUAL" onchange="toggleInputFields()" required checked>
        <label for="search_individual" class="type">Individual</label>
        <input type="radio" name="search_type" id="search_entity" value="ENTITY" onchange="toggleInputFields()" required>
        <label for="search_entity" class="type">Entity</label>

        <label for="name" title="Enter The Name To Search">Search Name:</label>
        <input type="text" name="name" id="name" placeholder="FirstName or LastName">
        <br><br>

        <label for="threshold" title="Enter The Matching Score To Search">Threshold (Optional):</label>
        <input type="number" name="threshold" id="threshold" min="0" max="100" value="80" oninput="validateThreshold()">
        <br><br>

        <label for="country" title="Enter The Country To Searc">Search Country:</label>
        <input type="text" name="country" id="country" placeholder="Select Country" oninput="showSuggestions(this.value)">
        <div id="suggestions" style="border: 1px solid #ccc; max-height: 200px; overflow-y: auto; display: none;"></div>
        <br><br>

        <label for="address" title="Enter The Address To Search">Search Address:</label>
        <input type="text" name="address" id="address" placeholder="Enter Address">
        <br><br>

        <label for="dob" title="Enter The Date Of Birth TO Search">Date of Birth:</label>
        <input type="text" name="dob" id="dob" placeholder="eg.YYYY-MM-DD or YYYY (Year only)">
        <br><br>

        <label for="passport" title="Enter The Passport Number To Search">Passport/PAN number:</label>
        <input type="text" name="passport" id="passport" placeholder="Enter Passport/PAN number">
        <br><br>
        <label for="email" title="Enter The Email Address To Search">Search e-mail Address:</label>
        <input type="text" name="email" id="email" placeholder="e-mail Address">
        <br><br>

        <button type="submit"class='search'>Search</button>
    </form>
    <!-- Loading Spinner and Text -->
    <div id="loading-container" style="display: none;">
        <div class="loader-5">
            <svg
              viewBox="0 0 187.3 93.7"
              height="200px"
              width="300px"
              class="svgbox"
            >
              <defs>
                <linearGradient y2="0%" x2="100%" y1="0%" x1="0%" id="gradient">
                  <stop stop-color="#8f44fd" offset="0%"></stop>

                  <stop stop-color="#fd44db" offset="100%"></stop>
                </linearGradient>
              </defs>

              <path
                stroke="url(#gradient)"
                d="M93.9,46.4c9.3,9.5,13.8,17.9,23.5,17.9s17.5-7.8,17.5-17.5s-7.8-17.6-17.5-17.5c-9.7,0.1-13.3,7.2-22.1,17.1c-8.9,8.8-15.7,17.9-25.4,17.9s-17.5-7.8-17.5-17.5s7.8-17.5,17.5-17.5S86.2,38.6,93.9,46.4z"
              ></path>
            </svg>
          </div>
        <div id="loading-text" style="font-weight: bold; text-align: center;">
            Loading, please wait...<span id="dots"></span>
        </div>
    </div>

    <div id="results-container" style="display: block;" onload="scrollToResults()">
        {% if search_type %}
        {% if results %}
            <h2>Results for {{ search_name if search_name else "the above details" }} :</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Score Accuracy</th>
                        <th>Source</th>
                        <th>Address</th>
                        <th>Alias name</th>
                        <th>Date Of Birth</th>
                        <th>Place Of Birth</th>
                        <th>Nationality</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in results %}
                    <tr>
                        <td>{{ result.Name if result.Name else "-" }}</td>
                        <td>{{ result.Name_score if result.Name_score else "-" }}</td>
                        <td>{{ result.Source if result.Source else "-" }}</td>
                        <td>{{ result.Address if result.Address else "-" }}</td>
                        <td>{{ result.Alias_name if result.Alias_name else "-"}}</td>
                        <td>{{ result.Date_of_Birth if result.Date_of_Birth else "-"}}</td>
                        <td>{{ result.Birth_Place if result.Birth_Place else "-"}}</td>
                        <td>{{ result.Nationality if result.Nationality else "-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="pagination-container">
                {% if page > 1 %}
                    <a class="pagination-button" href="{{ url_for('sanction', page=page-1, search_type=search_type, name=search_name, threshold=threshold, country=search_country, dob=search_dob, address=search_address) }}"><i class="fa-solid fa-backward"></i></a>
                {% endif %}
                <span class="pagination-info">Page {{ page }} of {{ total_pages }}</span>
                {% if has_next %}
                    <a class="pagination-button" href="{{ url_for('sanction', page=page+1, search_type=search_type, name=search_name, threshold=threshold, country=search_country, dob=search_dob, address=search_address) }}"><i class="fa-solid fa-forward"></i></a>
                {% endif %}
            </div>
            <button id="download-btn" onclick="downloadData()">
                Download All Data <i class="fa-solid fa-download"></i>
            </button>
                
            {% else %}
                <p>No results found. Please try a different search query.</p>
            {% endif %}
        {% endif %}
    </div>
    <footer>
        <p>Copyright &copy; 2025 All rights reserved.</p>
    </footer>    
    <script>
            function downloadData() {
    const btn = document.getElementById('download-btn');
    btn.disabled = true;
    btn.innerHTML = 'Downloading... <i class="fa-solid fa-spinner fa-spin"></i>';

    const url = `/sanction/download?search_type={{ search_type }}&name={{ search_name }}&threshold={{ threshold }}&country={{ search_country }}&dob={{ search_dob }}&address={{ search_address }}&email={{ search_email }}&passport={{ search_number }}`;

    fetch(url)
        .then(response => response.blob())
        .then(blob => {
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'sanction_results.csv'; // or whatever file name your server sends
            document.body.appendChild(link);
            link.click();
            link.remove();

            btn.innerHTML = 'Downloaded <i class="fa-solid fa-check"></i>';
            btn.disabled = false;
        })
        .catch(err => {
            console.error(err);
            btn.innerHTML = 'Download Failed';
            btn.disabled = false;
        });
}
        function validateThreshold() {
            var threshold = document.getElementById('threshold');
            if (threshold.value > 100) {
                threshold.value = 100; // Set the value to 100 
            }
        }
        function showLoading(event) {
                // Prevent default form submission
            event.preventDefault();
            // Hide the entire results container
            const resultsContainer = document.getElementById('results-container');
            if (resultsContainer) {
                resultsContainer.style.display = 'none';
            }
        
                // Show the loading text
            document.getElementById('loading-container').style.display = 'block';
        
                // Scroll to the loading text
            document.getElementById('loading-container').scrollIntoView({ behavior: 'smooth' });
        
                // Submit the form manually (if needed)
            event.target.submit();
        }
        // Function to scroll to the table after results are loaded
        function scrollToResults() {
            const resultsContainer = document.getElementById('results-container');
            if (resultsContainer && resultsContainer.style.display !== 'none') {
                resultsContainer.style.display = 'block';
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            // Only call scrollToResults if results exist
            if (document.querySelector("#results-container table tbody tr")) {
                scrollToResults();
            }
        });


        // countries from the API and store them
        let countries = [];

        fetch('https://restcountries.com/v3.1/all')
        .then(response => response.json())
        .then(data => {
            countries = data.map(country => country.name.common); // Extract the common name of the countries
        })
        .catch(error => console.log('Error fetching country data:', error));

        function showSuggestions(value) {
            const suggestionsDiv = document.getElementById("suggestions");
            suggestionsDiv.innerHTML = ''; // Clear previous suggestions
            if (value) {
                const filteredCountries = countries.filter(country => country.toLowerCase().startsWith(value.toLowerCase()));
                if (filteredCountries.length > 0) {
                    suggestionsDiv.style.display = 'block';
                    filteredCountries.forEach(country => {
                        const div = document.createElement('div');
                        div.textContent = country;
                        div.style.padding = '8px';
                        div.style.cursor = 'pointer';
                        div.onclick = function() {
                            document.getElementById("country").value = country;
                            suggestionsDiv.style.display = 'none'; // Hide suggestions when a country is selected
                        };
                        suggestionsDiv.appendChild(div);
                    });
                } else {
                    suggestionsDiv.style.display = 'none'; // Hide if no matches
                }
            } else {
                suggestionsDiv.style.display = 'none'; // Hide if input is empty
            }
        }

        // Close suggestions when clicking outside the input
        document.addEventListener("click", function(event) {
            const suggestionsDiv = document.getElementById("suggestions");
            const countryInput = document.getElementById("country");
            if (!countryInput.contains(event.target)) {
                suggestionsDiv.style.display = 'none';
            }
        });

                
        </script>
        <script src="https://kit.fontawesome.com/63b0973870.js" crossorigin="anonymous"></script>
</body>
</html>
